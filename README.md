# Cobalt

![version badge](https://img.shields.io/badge/version-4.0-2573bc)

Cobalt is a versatile platform offering many services to UConn students, including course information, professor ratings, dining hall menus, dorm reviews & imagery, classroom information, rec center traffic, and much more.

## Important Information

This project has been abandoned, and thus both this repository, and the v6 rewrite of Cobalt were open sourced. You can find the more up-to-date, less archiac and jank version of this project over at [@notm1ke/cobalt](https://github.com/notm1ke/cobalt).

If you are interested in maintaining this project please contact me at [me@m1ke.co](mailto:me@m1ke.co) or on Discord at ``@notm1ke``. Would love to see this project live on, I've let UConn though and do not have the time anymore.

## Quick Setup

Use npm to install Cobalt's required dependencies.

```bash
npm install
```

Cobalt depends on private npm modules hosting on the GitHub Packages Registry, therefore you will need to make a ``.npmrc`` file in the root of your project, and insert the following:

```env
@ilefa:registry=https://npm.pkg.github.com
//npm.pkg.github.com/:_authToken=${YOUR_TOKEN_VAR}
```

You will also need to obtain a personal access token for an account that has access to all dependent repositories, and reference it from an environment variable in order to fetch from the GitHub Packages Registry.

## Environment

An example ``.env.example`` is provided in the root of the project, rename it to ``.env`` and configure it with a valid ``GOOGLE_SHEETS_TOKEN`` for an account that has access to the [SRC Occupant Tracker](https://docs.google.com/spreadsheets/d/1BDgBidhnUfM2-4SNW4WoWOpsdW7gn-eVkVx1_PqZnrI/edit#gid=0) sheet. You can obtain a Google Sheets API Key from the [Google Cloud Developer Console](https://console.cloud.google.com) by creating a project and enabling the Google Sheets v4 API from the Library Explorer.

## Deployment Information

Any commits to ``master`` or ``v4`` will be automatically deployed to their respective website - please be careful when committing to prod/staging environments, and do so only after extensively testing your changes.

After you commit to this repository, you can track your deployment and it's analytics through the [Vercel](https://vercel.com/m1ke/cobalt) website.

## Project Structure

- [API](./pages/api)
  - The bulk of the API service is stored in this directory, utilizing Next.js API routes in order to facilitiate a single-codebase for both the frontend and backend service.
- [Pages](./pages)
  - All frontend routes are controlled and rendered from this directory.
- [Hooks](./hooks)
  - Utility hooks for communicating with the API service as well as some additional utilities like toggles, a debouncer, local storage handler, and others; uses the [createRemoteHook](./util/index.tsx#L925) utility for API communication.
- [Components](./components)
  - All reusable components are stored in this directory, such as utilities, major interface components, and other system components. Several subfolders exist for categorizing major component categories:
    - [Cards](./components/cards) contains all reusable card components, including those used for the dorms, dining, and status services.
    - [Env](./components/env) contains environment-specific utilities, such as the [DevElement](./components/env/DevElement.tsx) which only renders on development instances of Cobalt, or the [OneTimeView](./components/env/OneTimeView.tsx) which only renders once based on a local storage key.
    - [Inspection](./components/inspection) contains all components regarding to "inspection" pages, which are basically the main Cobalt feature pages (course inspection, rec insights, and room inspection.)
    - [Maps](./components/maps) contains all components needed for the maps service to work, such as markers, modals, etc.
    - [Ribbons](./components/ribbons) contains the various ribbons (Bootstrap alerts) used throughout Cobalt, such as the status warning, preview warning, and a base ribbon you can configure to work wherever needed.
    - [Styling](./components/styling) contains all of the custom stylesheets used throughout the app. These stylesheets use the CSS Modules convention of ``*.module.css`` which can be imported directly into components, and CSS rules are prepended by the module name to prevent collisions with other stylesheets.
- [Assets](./assets)
  - All SCSS files, FA, and a few other things are stored, but mainly this is used to house the UI Design System - Argon, by Creative Tim.
- [Public](./public)
  - Static assets are served from this directory and can be accessed from ``/:asset``.

## Routes

| Method | Route                     | Params                                                       | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|--------|---------------------------|--------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|   GET  | /api/bluefit              | ?mode={...}                                                  | Returns SRC occupancy information; can use multiple modes by specifying a comma-separated list. <ul><li>occupants: realtime occupant number</li> <li>daily: average dataset for plotting (for that day)</li> <li>weekly: average dataset for plotting (for all days)</li></ul>                                                                                                                                                                                                                                                                                                                                                                             |
|   GET  | /api/bluepages/{name}     |                                                              | Returns the [BluepagesRecord](https://github.com/ilefa/bluepages/blob/master/index.ts#L8) for a given faculty/staff member.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|   GET  | /api/blueplate            | <ul><li>hall</li> <li>date</li> <li>mode</li></ul>           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|   GET  | /api/bluesign             | <ul><li>room</li> <li>site</li> <li>free</li></ul>           | Returns the scheduled events for a given room or site (building), uses one or the provided param, with site taking priority if both are given. <ul><li>room: a standardized room name, for example, MCHU_201 or MCHU 201</li> <li>site: a standardized building code, for example, MCHU or GP</li> <li>free: all free rooms for a given site (campus type)</li></ul>                                                                                                                                                                                                                                                                                                                                                    |
|   GET  | /api/bluetrade/{name}     |                                                              | Returns the equivalent external courses for a given UConn course.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|   GET  | /api/buildings            |                                                              | Returns a complete list of all known (and documented) buildings at all UConn campuses, this includes all [Rooms](./util/index.tsx#L242) in those buildings and their technical information.                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|   GET  | /api/course/{name}        | <ul><li>campus</li> <li>bare</li> <li>initial</li></ul>      | Returns a [CompleteCoursePayload](./util/index.tsx#L120) of all information regarding a course. <ul><li>campus: filter by campus type</li> <li>bare: whether or not to just fetch the course mapping</li> <li>initial: whether or not this is the initial request (no professor insights), used for performance reasons</li></ul>                                                                                                                                                                                                                                                                                                                          |
|   GET  | /api/courses              |                                                              | Returns a complete list of all mapped courses from the [CourseMappings](https://github.com/ilefa/husky#course-mappings) collection.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|   GET  | /api/dorms                | ?type={...}                                                  | Returns the list of all documented dorms if no type is provided, if a type is provided, returns insights about that specific dorm type. <ul><li>type: a standardized [DormHallRmdId](./util/dorms.tsx#L144) key, for example, ALUMNI or MCMAHON</li></ul>                                                                                                                                                                                                                                                                                                                                                                                                  |
|   GET  | /api/enrollment/{name}    | ?section={...}&term={...}                                    | Returns realtime enrollment information for a given course section. Note: This information is not available for all sections, as summer courses and such work differently                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|   GET  | /api/maps                 |                                                              | Returns the [Cartographer](./hooks/useCartographer.tsx#L26) payload as specified in the environment file's CARTOGRAPHER_TARGET variable.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|   GET  | /api/professor/{...rmpId} |                                                              | Returns [professor insights](./hooks/useProfessor.tsx#L16) for the given RateMyProfessor ID(s).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|   GET  | /api/professors/{course}  | ?campus={...}                                                | Returns the list of professors for a given course name; can optionally filter by campus using the campus GET param.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|   GET  | /api/room/{name}          |                                                              | Returns the [Room](./util/index.tsx#L242) payload for a given room name.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|   GET  | /api/rooms                | ?mode={...}                                                  | Returns a complete list of all known classrooms (that have technical documentation); use mode to dictate output: <ul><li>name: return a list of all room names</li> <li>full: return a list of [Rooms](./util/index.tsx#L242)</li></ul>                                                                                                                                                                                                                                                                                                                                                                                                                    |
|   GET  | /api/search               | <ul><li>input</li> <li>advancedOpts</li> <li>limit</li></ul> | Returns search results for [CobaltSearch](./components/CobaltSearch.tsx) v2 given the required GET params: <ul><li>input: the raw input string the user requested</li> <li>advancedOpts: search v2 [advanced properties](./components/CobaltSearch.tsx#L79)</li> <li>limit: the amount of results to limit to, or -1 to not limit results</li></ul>                                                                                                                                                                                                                                                                                                        |
|   GET  | /api/sections/{course}    | ?campus={...}                                                | Returns a list of sections for the given course; can be limited using the campus GET param.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|   GET  | /api/statistics           | ?mode={...}                                                  | Returns service statistics regarding served data; output controlled by the mode param which can be a comma-separated list: <ul><li>full: return all statistic types</li> <li>courses: add course count to result</li> <li>professors: add professor count to result</li> <li>rooms: add room count to result</li> <li>buildings: add building count to result</li> <li>assets: add asset count to result</li></ul>                                                                                                                                                                                                                                         |
|   GET  | /api/status               | ?include={...}                                               | Returns upstream service statuses; output controlled by the include GET param which can be a comma-separated list: <ul><li>all: returns all services in response</li> <li>aurora: add aurora status to output</li> <li>catalog: add catalog status to output</li> <li>email: add email status to output</li> <li>huskyct: add huskyct status to output</li> <li>kfs: add kfs status to output</li> <li>netid: add netid status to output</li> <li>network: add network status to output</li> <li>phonebook: add phonebook status to output</li> <li>student_admin: add student admin status to output</li> <li>webex: add webex status to output</li></ul> |